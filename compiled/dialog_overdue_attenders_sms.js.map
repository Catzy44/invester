{"version":3,"file":"dialog_overdue_attenders_sms.js","names":["Dialog","showDialog","jsx","___EmotionJSX","OverdueAttenderPaymentsSMS","React","Component","state","running","justFinished","constructor","props","placesArr","message","render","infoEl","createElement","Fragment","length","workers","totalCount","finishedCount","filter","worker","finished","setState","className","style","maxWidth","disabled","type","value","onClick","begin","map","placeId","id","errored","forEach","fet","method","body","content","then","res","catch","err","console","log","OverdueAttenderPaymentsSMSDialog","title"],"sources":["../uncompiled/dialog_overdue_attenders_sms.js"],"sourcesContent":["import {Dialog,showDialog} from \"./dialog.js\";\r\nclass OverdueAttenderPaymentsSMS extends React.Component {\r\n    state = {\r\n        running: false,\r\n        justFinished: false\r\n    }\r\n    constructor(props) {\r\n        super(props);\r\n        this.placesArr = props.placesArr\r\n        this.message = props.message\r\n    }\r\n\r\n    running = false\r\n    render() {\r\n        let infoEl = <>wybrane miejsca: {this.placesArr.length}</>\r\n\r\n        if(this.workers != null) {\r\n            const totalCount = this.workers.length\r\n            const finishedCount = this.workers.filter(worker=>worker.finished).length\r\n            if(this.state.running) {\r\n                infoEl = <>ukończono: {finishedCount}/{totalCount}</>\r\n            }\r\n\r\n            if(finishedCount == totalCount) {\r\n                this.setState(state=>({...state,running:false,justFinished:true}))\r\n            }\r\n            if(this.state.justFinished) {\r\n                infoEl = <>ukończono!</>\r\n            }\r\n        }\r\n\r\n        return <div className=\"dialog_overdue_messages\">\r\n            <span style={{maxWidth:\"200px\"}}>Funkcja spowoduje wysłanie wiadomości do wszystkich uczestników zalegających z płatnościami w wybranych miejscach</span>\r\n            <span style={{maxWidth:\"200px\"}}>Procesu nie należy przerywać, może on zająć do kilku minut</span>\r\n            {infoEl}\r\n            <input disabled={this.state.running} type=\"button\" value={this.state.running ? \"w toku...\" : \"rozpocznij\"} onClick={this.begin}/>\r\n        </div>\r\n    }\r\n\r\n    workers = null\r\n    begin = ()=>{\r\n        this.setState(state=>({...state,running:true}))\r\n        this.workers = this.placesArr.map(placeId=>{\r\n            return {\r\n                id: placeId,\r\n                finished: false,\r\n                running: false,\r\n                errored: false\r\n            }\r\n        })\r\n        this.workers.forEach(worker=>{\r\n            fet(`places/${worker.id}/payments/sendSMSesToOverdueAttenders`,{method:\"POST\",body:{content:this.message}}).then(res=>{\r\n                worker.running = false\r\n                worker.finished = true\r\n                this.render()\r\n            }).catch(err=>{\r\n                worker.running = false\r\n                worker.finished = true\r\n                worker.errored = true\r\n                console.log(err)\r\n            })\r\n        })\r\n    }\r\n}\r\nexport function OverdueAttenderPaymentsSMSDialog(props) {\r\n    return <Dialog title=\"zaległe płatności\">\r\n        <OverdueAttenderPaymentsSMS {...props}/>\r\n    </Dialog>\r\n}\r\n"],"mappings":"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","ignoreList":[]}